<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI1team — ROI Kalkulator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="A1Favicon.png" />
  <style>
    body { font-family: 'Inter', sans-serif; margin:0; color:#111; background:#fff; }
    header { display:flex; justify-content:space-between; align-items:center; padding:20px 32px; border-bottom:2px solid #f3f3f3; }
    h1 { font-size:32px; color:#0b3d91; margin-bottom:8px; }
    p.lead { font-size:18px; color:#333; margin-top:0; }
    .wrap { max-width:960px; margin:40px auto; padding:0 16px; }
    .btn { background:#d4af37; color:#fff; border:none; border-radius:6px; padding:12px 20px; font-weight:600; cursor:pointer; }
    .btn:hover { background:#b38e1e; }
    .btn:disabled { background:#ccc; cursor:not-allowed; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    input, select { width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; box-sizing:border-box; }
    label { font-size:14px; font-weight:600; display:block; margin-bottom:6px; }
    .card { border:1px solid #ddd; border-radius:10px; padding:20px; margin-top:24px; }
    footer { text-align:center; margin:60px 0 24px; font-size:13px; color:#444; }
    footer img { height:28px; margin-top:12px; }
    .results { margin-top:18px; padding:14px; border-radius:8px; background:#f7f9fb; border:1px solid #e6eef8; }
    .result-row { display:flex; justify-content:space-between; padding:6px 0; font-weight:600; color:#0b3d91; }
    .small { font-weight:400; color:#333; font-size:14px; }
    .muted { font-weight:400; color:#666; font-size:13px; }
    .checkbox { display:inline-block; align-items:center; gap: 10px; }
    .health-score-badge { 
      display:inline-block; 
      padding:10px 16px; 
      border-radius:8px; 
      font-size:18px; 
      font-weight:700; 
      color:#fff; 
      margin:12px 0;
      text-align:center;
    }
    .health-good { background:#1b8f3f; }
    .health-mid { background:#d18b00; }
    .health-bad { background:#c73535; }
    .health-hint { font-size:13px; color:#666; margin-top:4px; }
    @media (max-width:720px) {
      h1 { font-size:28px; color:#0b3d91; margin-bottom:8px; text-align: center;}
      p.lead { font-size:16px; color:#333; margin-top:0; text-align: center;}
      .grid { grid-template-columns:1fr; }
      header { flex-direction:column; gap:12px; align-items:center; }
    }
  </style>
</head>
<body>
  <header>
    <img class="logo" src="aiteam-logo.png" alt="AI1team" style="height:70px;">
    <div class="logo-text" style="font-size:14px; color:#0b3d91;">AI rešenja za pametniji e-commerce</div>
  </header>

  <div class="wrap">
    <section id="hero">
      <h1>Koliko AI može smanjiti vaše zalihe?</h1>
      <p class="lead">Unesite svoje brojke i za 30 sekundi saznajte potencijalnu godišnju uštedu, ROI i Health Score vašeg poslovanja.</p>
    </section>

    <form id="roiForm" class="card" onsubmit="return submitToBackend(event)">
      <h2>Podaci o kompaniji</h2>
      <div class="grid">
        <div>
          <label>Naziv kompanije</label>
          <input name="company" id="company" required>
        </div>
        <div>
          <label>Kontakt osoba</label>
          <input name="contact" id="contact" required>
        </div>
        <div>
          <label>Email</label>
          <input type="email" name="email" id="email" required>
        </div>
      </div>

      <h2 style="margin-top:18px;">Operativni podaci</h2>
      <div class="grid">
        <div>
          <label>Godišnji prihod €</label>
          <input type="number" name="annualRevenue" id="annualRevenue" min="0" step="0.01" required>
        </div>
        <div>
          <label>Vrednost zaliha €</label>
          <input type="number" name="inventoryValue" id="inventoryValue" min="0" step="0.01" required>
        </div>
        <div>
          <label>Mrtvih zaliha (dead stock) %</label>
          <input type="number" name="overstockPct" id="overstockPct" min="0" max="100" step="0.01" required>
        </div>
        <div>
          <label>Nedostupnih artikala (out-of-stock) %</label>
          <input type="number" name="oosPct" id="oosPct" min="0" max="100" step="0.01" required>
        </div>
        <div>
          <label>COGS %</label>
          <input type="number" name="cogsPct" id="cogsPct" min="0" max="100" step="0.01" required>
        </div>
        <div>
          <label>Marketing %</label>
          <input type="number" name="marketingPct" id="marketingPct" min="0" max="100" step="0.01" required>
        </div>
        <div>
          <label>Logistika %</label>
          <input type="number" name="logisticsPct" id="logisticsPct" min="0" max="100" step="0.01" required>
        </div>
        <div>
          <label>Operativa %</label>
          <input type="number" name="operationsPct" id="operationsPct" min="0" max="100" step="0.01" required>
        </div>
        <div>
          <label>Broj artikala SKU</label>
          <input type="number" name="sku" id="sku" min="0" step="1" required>
        </div>
        <div>
          <label>Broj skladišta</label>
          <input type="number" name="warehouses" id="warehouses" min="0" step="1" required>
        </div>
        <div>
          <label>Broj prodajnih kanala</label>
          <input type="number" name="channels" id="channels" min="0" step="1" required>
        </div>
        <div>
          <label>Očekivana AI preciznost %</label>
          <select name="accuracy" id="accuracy">
            <option value="70">70</option>
            <option value="80">80</option>
            <option value="85" selected>85</option>
            <option value="90">90</option>
            <option value="95">95</option>
          </select>
        </div>
      </div>

      <div class="checkbox" style="margin-top:16px;">
        <input type="checkbox" id="gdpr" required> 
      </div>
      <div class="checkbox" style="margin-left:4px;">
        <label for="gdpr" style="font-size:13px;" class="small">Slažem se sa obradom podataka radi ROI procene i ponude GDPR</label>
      </div>

      <div class="results" id="liveResults" aria-live="polite">
        <div id="healthScoreDisplay" style="text-align:center;"></div>
        
        <div class="result-row"><div class="muted">Procena godišnje uštede</div><div id="aiSavingsDisplay">-</div></div>
        <div class="result-row"><div class="muted">Mesečna pretplata (procena)</div><div id="monthlyFeeDisplay">-</div></div>
        <div class="result-row"><div class="muted">Godišnja pretplata</div><div id="annualFeeDisplay">-</div></div>
        <div class="result-row"><div class="muted">Procena ROI</div><div id="roiDisplay">-</div></div>
        <!-- REMOVED FROM DISPLAY BUT STILL SENT IN EMAIL: Odnos zaliha i prihoda, Procena mrtve zalihe, Signal za prekomerne zalihe, OOS signal, Iskorišćenost zaliha -->
        
        <div style="margin-top:8px;" class="small">Rezultati se ažuriraju dok menjate polja. Pre slanja, vrednosti će biti uključene u poruci.</div>
      </div>

      <!-- Hidden values that will be sent to backend -->
      <input type="hidden" name="_next" id="_next" value="https://www.ai1team.com/thankyou.html">
      <input type="hidden" name="healthScore" id="healthScore">
      <input type="hidden" name="healthBand" id="healthBand">
      <input type="hidden" name="estimatedSavings" id="estimatedSavings">
      <input type="hidden" name="monthlyFee" id="monthlyFee">
      <input type="hidden" name="annualFee" id="annualFee">
      <input type="hidden" name="roiPercent" id="roiPercent">
      <input type="hidden" name="roiEuro" id="roiEuro">
      <input type="hidden" name="inventoryToRevenue" id="inventoryToRevenue">
      <input type="hidden" name="deadStock" id="deadStock">
      <input type="hidden" name="overstockSignal" id="overstockSignal">
      <input type="hidden" name="oosSignal" id="oosSignal">
      <input type="hidden" name="inventoryUtilization" id="inventoryUtilization">
      <input type="hidden" name="strategyCall" id="strategyCall" value="Requested">
      <input type="hidden" name="poc" id="poc" value="Interested">
      <input type="hidden" name="note" id="note">

      <div style="margin-top:16px;">
        <button type="submit" class="btn">Izračunaj ROI i pošalji</button>
      </div>
    </form>
  </div>

  <footer>
    AI1team © 2025 — Beograd · <a href="mailto:roi@ai1team.com">roi@ai1team.com</a><br>
    <img src="aiteam-logo.png" alt="AI1team" style="height:45px;">
  </footer>

  <script>
// ---------- Utility functions ----------
function cleanNumber(value) {
  return parseFloat(value.replace(/\./g, '').replace(',', '.')) || 0;
}

function formatCurrency(value) {
  return value.toLocaleString('de-DE');
}

function num(v) {
  return isNaN(+v) ? 0 : +v;
}

// ---------- Health Score Calculation ----------
function calcHealth({rev, inv, over, oos, cogs, mkt, logi, ops}) {
  const invToRev = rev > 0 ? inv / rev : 0;
  let score = 100;

  // Deduct based on inventory-to-revenue ratio
  score -= Math.min(40, invToRev * 140);
  
  // Deduct based on overstock
  score -= Math.min(20, over * 0.9);
  
  // Deduct based on out-of-stock
  score -= Math.min(15, oos * 1.0);

  // Deduct based on total costs
  const totalCost = cogs + mkt + logi + ops;
  if (totalCost > 85) score -= 10;
  if (totalCost > 95) score -= 8;

  score = Math.max(1, Math.min(99, Math.round(score)));

  let band = 'MID', css = 'health-mid', hint = 'Stabilno — postoji prostor za rast';

  if (score >= 76) { 
    band = 'HIGH'; 
    css = 'health-good'; 
    hint = 'Zdravo: kapital radi efikasno'; 
  } else if (score <= 50) { 
    band = 'LOW'; 
    css = 'health-bad'; 
    hint = 'Rizik: kapital blokiran'; 
  }

  return {score, band, css, hint, invToRev};
}

// ---------- Compute all values ----------
function computeValues() {
  const annualRevenue = cleanNumber(document.getElementById('annualRevenue').value);
  const inventoryValue = cleanNumber(document.getElementById('inventoryValue').value);
  const overstockPct = parseFloat(document.getElementById('overstockPct').value) || 0;
  const oosPct = parseFloat(document.getElementById('oosPct').value) || 0;
  const cogsPct = parseFloat(document.getElementById('cogsPct').value) || 0;
  const marketingPct = parseFloat(document.getElementById('marketingPct').value) || 0;
  const logisticsPct = parseFloat(document.getElementById('logisticsPct').value) || 0;
  const operationsPct = parseFloat(document.getElementById('operationsPct').value) || 0;
  const sku = parseFloat(document.getElementById('sku').value) || 0;
  const warehouses = parseFloat(document.getElementById('warehouses').value) || 0;
  const channels = parseFloat(document.getElementById('channels').value) || 0;

  // Calculate Health Score
  const healthData = calcHealth({
    rev: annualRevenue,
    inv: inventoryValue,
    over: overstockPct,
    oos: oosPct,
    cogs: cogsPct,
    mkt: marketingPct,
    logi: logisticsPct,
    ops: operationsPct
  });

  // Calculate AI Savings
  const overstockLoss = inventoryValue * (overstockPct / 100);
  const oosLoss = annualRevenue * (oosPct / 100);
  const aiSavings = (overstockLoss * 0.30) + (oosLoss * 0.40);

  // Calculate Fees
  let fee = 1000 + (300 * warehouses) + (200 * channels) + (150 * (sku / 1000));
  if (fee < 3000) fee = 3000;

  const monthlyFee = Math.round(fee);
  const annualFee = Math.round(fee * 12);
  const roiEuro = aiSavings - annualFee;
  const roi = annualFee > 0 ? roiEuro / annualFee : 0;
  const roiPercent = isFinite(roi) && annualFee > 0 ? Math.round(roi * 10000) / 100 : 0;

  // Additional metrics
  const invToRev = (healthData.invToRev * 100).toFixed(1);
  const deadStock = Math.round(inventoryValue * (overstockPct / 100) * 0.25); // Estimate 25% of overstock as dead
  const overstockSignal = overstockPct > 12 ? 'Visok' : overstockPct > 8 ? 'Umeren' : 'Nizak';
  const oosSignal = oosPct > 7 ? 'Visok' : oosPct > 4 ? 'Umeren' : 'Nizak';
  const inventoryUtil = Math.round((1 - (overstockPct / 100)) * 100); // STILL CALCULATED - just not displayed

  return { 
    healthScore: healthData.score,
    healthBand: healthData.band,
    healthCss: healthData.css,
    healthHint: healthData.hint,
    aiSavings: Math.round(aiSavings), 
    monthlyFee, 
    annualFee, 
    roiPercent,
    roiEuro: Math.round(roiEuro),
    invToRev,
    deadStock,
    overstockSignal,
    oosSignal,
    inventoryUtil  // STILL RETURNED - will be sent in email
  };
}

function updateLiveDisplay() {
  const vals = computeValues();
  
  // Display Health Score
  document.getElementById('healthScoreDisplay').innerHTML = `
    <div class="health-score-badge ${vals.healthCss}">
      Health Score: ${vals.healthScore}/100 — ${vals.healthBand}
    </div>
    <div class="health-hint">${vals.healthHint}</div>
  `;
  
  document.getElementById('aiSavingsDisplay').textContent = formatCurrency(vals.aiSavings) + ' €';
  document.getElementById('monthlyFeeDisplay').textContent = formatCurrency(vals.monthlyFee) + ' €';
  document.getElementById('annualFeeDisplay').textContent = formatCurrency(vals.annualFee) + ' €';
  document.getElementById('roiDisplay').textContent = vals.roiPercent + ' %';
  // REMOVED FROM DISPLAY but still calculated and sent in email: Inventory to Revenue, Dead Stock, Overstock Signal, OOS Signal, Inventory Utilization
}

// Currency input formatting
['annualRevenue', 'inventoryValue'].forEach(id => {
  const el = document.getElementById(id);
  el.type = 'text';
  el.addEventListener('input', () => {
    let value = el.value.replace(/\D/g, '');
    if (value) {
      const numberValue = parseFloat(value);
      el.value = formatCurrency(numberValue);
    } else {
      el.value = '';
    }
    updateLiveDisplay();
  });
});

const inputs = ['overstockPct','oosPct','cogsPct','marketingPct','logisticsPct','operationsPct','sku','warehouses','channels','accuracy'];
inputs.forEach(id => {
  const el = document.getElementById(id);
  if (el) el.addEventListener('input', updateLiveDisplay);
});
updateLiveDisplay();

// ---------- Submission logic ----------
function collectFormValues() {
  const vals = computeValues();
  
  // Set hidden fields
  document.getElementById('healthScore').value = vals.healthScore;
  document.getElementById('healthBand').value = vals.healthBand;
  document.getElementById('estimatedSavings').value = vals.aiSavings;
  document.getElementById('monthlyFee').value = vals.monthlyFee;
  document.getElementById('annualFee').value = vals.annualFee;
  document.getElementById('roiPercent').value = vals.roiPercent || '';
  document.getElementById('roiEuro').value = vals.roiEuro;
  document.getElementById('inventoryToRevenue').value = vals.invToRev + '%';
  document.getElementById('deadStock').value = vals.deadStock;
  document.getElementById('overstockSignal').value = vals.overstockSignal;
  document.getElementById('oosSignal').value = vals.oosSignal;
  document.getElementById('inventoryUtilization').value = vals.inventoryUtil + '%'; // STILL SENT IN EMAIL
  document.getElementById('note').value = 'AI1team ROI+ Calculator: Health Score computed with inventory optimization analysis';

  return {
    company: document.getElementById('company').value.trim(),
    contact: document.getElementById('contact').value.trim(),
    email: document.getElementById('email').value.trim(),
    healthScore: vals.healthScore + '/100',
    healthBand: vals.healthBand,
    annualRevenue: document.getElementById('annualRevenue').value + ' €',
    inventoryValue: document.getElementById('inventoryValue').value + ' €',
    overstockPct: document.getElementById('overstockPct').value + ' %',
    oosPct: document.getElementById('oosPct').value + ' %',
    cogsPct: document.getElementById('cogsPct').value + ' %',
    marketingPct: document.getElementById('marketingPct').value + ' %',
    logisticsPct: document.getElementById('logisticsPct').value + ' %',
    operationsPct: document.getElementById('operationsPct').value + ' %',
    sku: formatCurrency(parseFloat(document.getElementById('sku').value) || 0),
    warehouses: formatCurrency(parseFloat(document.getElementById('warehouses').value) || 0),
    channels: formatCurrency(parseFloat(document.getElementById('channels').value) || 0),
    accuracy: document.getElementById('accuracy').value + ' %',
    estimatedSavings: formatCurrency(vals.aiSavings) + ' €',
    monthlyFee: formatCurrency(vals.monthlyFee) + ' €',
    annualFee: formatCurrency(vals.annualFee) + ' €',
    roiPercent: vals.roiPercent !== null ? vals.roiPercent + ' %' : '-',
    roiEuro: formatCurrency(vals.roiEuro) + ' €',
    inventoryToRevenue: vals.invToRev + ' %',
    deadStock: formatCurrency(vals.deadStock) + ' €',
    overstockSignal: vals.overstockSignal,
    oosSignal: vals.oosSignal,
    inventoryUtilization: vals.inventoryUtil + ' %', // STILL INCLUDED IN EMAIL DATA
    strategyCall: 'Requested',
    poc: 'Interested',
    note: document.getElementById('note').value
  };
}

async function submitToBackend(e) {
  e.preventDefault();
  const data = collectFormValues();

  if (!data.company || !data.email) {
    alert('Popunite obavezna polja: Naziv kompanije i Email');
    return false;
  }

  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.disabled = true;
  submitBtn.textContent = 'Šalje se...';

  try {
    const resp = await fetch('https://formspree.io/f/mblqlabn', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify(data)
    });
    if (resp.ok) {
      window.location.href = document.getElementById('_next').value;
    } else {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
      alert('Došlo je do greške pri slanju. Pokušajte ponovo.');
    }
  } catch (err) {
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    alert('Greška u konekciji. Pokušajte ponovo.');
  }
}
</script>

</body>
</html>
